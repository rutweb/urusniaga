@{* 
    Name: default-pointofsale
    Update: 25022017

    Variables setting, will overwritten by template setting. 
*}

@{* start variables setting *}
@{$TITLE="Sales Receipt"}
@{$SUBJECT=""}
@{$FONT="arial, sans-serif"}
@{$CELL_BORDER="1px solid #dddddd"}
@{$CELL_HIGHLIGHT_COLOR="#d0d0d0"}
@{$HEADER_BACKGROUND_COLOR="#000000"}
@{$HEADER_TEXT_COLOR="#ffffff"}
@{$SIGNATURE_LINE_BORDER="1px dotted #bbbbbb"}
@{$SHOW_DISCOUNT_PERCENT=false}
@{$SHOW_COMPANY_CONTACT=true}
@{$SHOW_COMPANY_ADDRESS=true}
@{* /end variables setting *}

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="google" content="notranslate">
<meta name="format-detection" content="telephone=no">
<title>@{$TITLE} @{$data->pointofsale->code}</title>

<style type="text/css">
/* start reset */
html {
  font-family: @{$FONT};
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}

body {
    font-size: 12px;
    margin: 0;
    background: #fff;
    line-height: 1.3;
}

@media print {
    body {-webkit-print-color-adjust: exact;}
}

table {
    border-collapse: collapse !important;
    border-spacing: 0;
    border: none;
}

span {
    padding: 0;
    margin: 0;
}

td,
th {
    padding: 0;
}

td {
    font-size: 12px;
    text-align: left;
}

img {
    border: 0;
    padding: 0;
}

/* end reset */

.width-px-10 {
    width: 10px;
}

.width-px-60 {
    width: 60px;
}

.width-px-90 {
    width: 60px;
}

.width-px-100 {
    width: 100px;
}

.width-percent-10 {
    width: 10%;
}

.width-percent-35 {
    width: 35%;
}

.width-percent-55 {
    width: 55%;
}

.pos-title {
    font-size: 14px;
    font-weight: bold;
}

.text-block {
    display: block;
}

.text-block-inline {
    display: inline-block;
}

.text-center {
    text-align: center !important;
}

.text-left {
    text-align: left !important;
}

.text-right {
    text-align: right !important;
}

.text-uppercase {
    text-transform: uppercase;
}

.text-lowercase {
    text-transform: lowercase;
}

.text-capitalize {
    text-transform: capitalize;
}

b,
.text-bold {
    font-weight: bold !important;
}

.text-nowrap {
    white-space: nowrap;
}

td.cell {
    vertical-align:top;
    padding:4px;
    border:@{$CELL_BORDER};
}

td.cell-empty {
    border: none;
}

table.main {
    width: 400px;
    border: none;
    padding: 0;
    margin: 0;
    margin-left:auto;
    margin-right:auto;
    border-spacing: 0;
}

table.header {
    clear: both;
    width: 100%;
    border: none;
    border-bottom:1px solid #bbbbbb;
    padding: 0;
    margin: 0;
    margin-left:auto;
    margin-right:auto;
    margin-bottom: 5px;
    border-spacing: 0;
}

table.header td {
    vertical-align:top;
}

table.item {
    clear: both;
    width: 100%;
    border: none;
    padding: 0;
    margin: 0;
    margin-left:auto;
    margin-right:auto;
    margin-top: 10px;
    margin-bottom: 5px;
    border-spacing: 0;
}

table.item th {
    background:#ffffff;
    color:#000000;
    padding:4px; 
}

table.item td {
    border-left:none;
    border-right: none;
}

.bg-highlight {
    background:@{$CELL_HIGHLIGHT_COLOR};
}

</style>
</head>
<body scroll="auto">

<table class="main">
<tr>
<td>

<!--## HEADER START ##-->
<table class="header">
<tr>

<!--## COMPANY INFORMATION ##-->
<td>
<center>
<span class="text-block pos-title text-capitalize">
@{$data->pos_name}<br>
</span>

<span class="text-block">
    @{$data->company->name}
    @{!_null($data->company->regnumber)?" (".$data->company->regnumber.")":""}
</span>

@{if="!_null($data->company->address) && (bool)$SHOW_COMPANY_ADDRESS"}
    <span class="text-block">@{$data->company->address}</span>

    <span class="text-block text-capitalize">
        <!--## COMPANY CITY ##-->
        @{!_null($data->company->city) ? $data->company->city.",&nbsp;" : ""}

        <!--## COMPANY POSTCODE ##-->
        @{!_null($data->company->postcode) ? $data->company->postcode.",&nbsp;" : ""}

        <!--## COMPANY STATE ##-->
        @{!_null($data->company->state) ? $data->company->state.",&nbsp;" : ""}

        <!--## COMPANY COUNTRY ##-->
        @{!_null($data->company->country) ? $data->company->country : ""}
    </span>

@{/if}

@{if="(bool)$SHOW_COMPANY_CONTACT"}
    <span class="text-block">

    <!--## COMPANY PHONE ##-->
    @{if="!_null($data->company->phone)"}
        Phone: @{$data->company->phone}&nbsp;
    @{/if}

    <!--## COMPANY FAX ##-->
    @{if="!_null($data->company->fax)"}
        Fax: @{$data->company->fax}
    @{/if}

    </span>

    <span class="text-block">
    <!--## COMPANY EMAIL ##-->
    @{if="!_null($data->company->email)"}
        Email: @{$data->company->email}&nbsp;
    @{/if}

    <!--## COMPANY WEBSITE ##-->
    @{if="!_null($data->company->website)"}
        Website: @{$data->company->website}
    @{/if}
    </span>

    @{if="_array($data->list->tax_regnumber)"}
        <br>
        @{loop="$data->list->tax_regnumber"}
        @{if="_null($key)"}@{continue}@{/if}
            <span class="text-block">
            <b>@{$key} No:</b> @{$value}
            </span>
        @{/loop}
    @{/if}
@{/if}

<span class="text-block" style="margin-top:5px";>
<span class="text-block-inline" style="margin-right:2px;"><b>Sale No:</b> @{$data->pointofsale->code}</span>
<span class="text-block-inline" style="margin-left:2px;"><b>Customer:</b> @{$data->customer->name}</span>
</span>

<p>
<span class="text-block">
<b>Location:</b> @{$data->pos_location_name}
</span>
</p>

<span class="text-block">
@{$data->pointofsale->ldate|_format_datetime}
</span>

@{if="!_null($TITLE)"}
<h4>@{$TITLE}</h4>
@{/if}

</td>
<!--## END COMPANY INFORMATION ##-->

</center>
</table>

<table class="item">
<tr>
<!--## ITEMS HEADER ##-->
<th class="text-center width-px-10">No.</th>
<th class="text-left">Item</th>
<th class="text-center width-px-60">Quantity</th>
<th class="text-right width-px-60">Unit Price</th>
<th class="text-right width-px-60">Subtotal</th>
@{if="$data->pointofsale->tax_option == 1"}
    <th class="text-right width-px-60">Tax Rate</th>
@{/if}
</tr>

<!--## ITEMS LIST ##-->
@{$total=0}
@{$total_tax_rate=0}
@{$tax_exclusive=array()}
@{$tax_inclusive=array()}
@{$total_discount_rate=0}

@{loop="$data->list->items"}
    @{$value.subtotal=$value.price * $value.quantity}
    @{$total=$total + $value.subtotal}

    <tr>
    <td class="cell text-center">
        @{$counter+1}
    </td>
    <td class="cell">
        @{$value.name|nl2br}
    </td>
    <td class="cell text-center">
        @{$value.quantity}
    </td>
    <td class="cell text-right">
        @{$value.price|_int_output_thousands_sep}
    </td>
    <td class="cell text-right">
        @{$value.subtotal|_int_output_thousands_sep}
    </td>

    @{if="$data->pointofsale->discount_option == 1"}

        @{$discount_rate=$value.discount_rate}

        @{if="$value.discount_percent"}
            @{$discount_rate=_int_output($discount_rate)}
            @{$discount_rate_rate=_calc_percent($value.subtotal, $discount_rate)}
        @{else}
            @{$discount_rate_rate=$discount_rate}
        @{/if} <!-- / discount_percent -->

        <td class="cell text-right">
            @{$total_discount_rate=$total_discount_rate + $discount_rate_rate}

            @{$discount_rate_rate|_int_output_thousands_sep}

            @{if="isset($SHOW_DISCOUNT_PERCENT) && (bool)$SHOW_DISCOUNT_PERCENT"}
                <span class="text-block">@{$discount_rate}%</span>
            @{/if}

        </td>

    @{/if} <!--/ discount_option == 1 -->

<!-- tax per item -->
    @{if="$data->pointofsale->tax_option == 1"}
        @{$tax_rate_rate=0}
        @{$taxcode_name=""}
        @{if="!_null($value.tax_name)"}

            @{if="$value.taxcode_id > 0"}
                @{$taxcode_name=$value.taxcode_name}
                @{$value.tax_name=$value.tax_name." ".$taxcode_name}
                @{$value.tax_percent=$value.taxcode_percent} 
                @{$value.tax_rate=$value.taxcode_rate} 
            @{/if}

            @{$tax_name=$value.tax_name}
            @{$tax_rate=$value.tax_rate}

            @{if="$value.tax_percent == 1"}
                @{$tax_rate=_int_output($tax_rate)}

                @{$divide=100}
                @{if="$value.tax_operation == 1"}
                    @{$divide=100+$tax_rate}
                @{/if}

                @{$tax_rate_rate=_calc_percent($value.subtotal, $tax_rate, $divide)}

                @{$tax_text="$tax_rate%"}
            @{else}
                @{$tax_rate=_int_output($tax_rate,2)}
                @{$tax_rate_rate=$tax_rate}
                @{$tax_text="$tax_rate"}
            @{/if} <!-- / tax_percent -->

            @{if="$value.tax_operation == 0"}
                @{$tax_exclusive[$tax_name]['rate']=$tax_text}
                @{if="!isset($tax_exclusive[$tax_name]['total'])"}
                    @{$tax_exclusive[$tax_name]['total'] = 0}
                @{/if}
                @{$tax_exclusive[$tax_name]['total']=$tax_exclusive[$tax_name]['total'] + $tax_rate_rate}
                @{$total_tax_rate=$total_tax_rate + $tax_rate_rate}
            @{else}
                @{$tax_inclusive[$tax_name]['rate']=$tax_text}
                @{if="!isset($tax_inclusive[$tax_name]['total'])"}
                    @{$tax_inclusive[$tax_name]['total'] = 0}
                @{/if}
                @{$tax_inclusive[$tax_name]['total']=$tax_inclusive[$tax_name]['total'] + $tax_rate_rate}
            @{/if}
        @{/if}
        <td class="cell text-right">
            @{$tax_rate_rate|_int_output_thousands_sep} @{$taxcode_name}
        </td>
    @{/if} <!--/ tax_option == 1 -->
<!-- /tax per item -->
</tr>
@{/loop}
</table>

<table class="item">

<!--## ITEMS FOOTER ##-->
<tr>
<td class="cell cell-empty">&nbsp;</td>
<td class="cell cell-empty width-px-100 text-nowrap text-right text-bold">Total</td>
<td class="cell cell-empty width-px-10 text-nowrap text-right">@{$data->currencycode->symbol}</td>
<td class="cell cell-empty width-px-60 text-nowrap text-right">@{$total|_int_output_thousands_sep}</td>
</tr>

<!-- discount rate -->
@{if="$data->pointofsale->discount_option == 2"}
    @{$total_discount_rate=$data->pointofsale->total_discount}

@{/if}

@{if="$total_discount_rate != 0"}

    <tr>
    <td class="cell cell-empty">&nbsp;</td>
    <td class="cell cell-empty width-px-100 text-nowrap text-right text-bold">Discount</td>
    <td class="cell cell-empty width-px-10 text-nowrap text-right">@{$data->currencycode->symbol}</td>
    <td class="cell cell-empty width-px-60 text-nowrap text-right">

        @{$total_discount_rate|_int_output_thousands_sep}

        @{if="isset($SHOW_DISCOUNT_PERCENT) && (bool)$SHOW_DISCOUNT_PERCENT"}
            @{$discount_rate_sum=_int_output($total_discount_rate) * 100 / _int_output($total)}
            <span class="text-block">@{$discount_rate_sum|round:2}%</span>
        @{/if}

    </td>
    </tr>

    @{$total=$total-$total_discount_rate}
@{/if}

<!-- tax per item -->
@{if="$data->pointofsale->tax_option == 1"}

    @{if="_array($tax_exclusive)"}
        @{loop="$tax_exclusive"}
        @{if="_null($key)"}@{continue}@{/if}
        @{if="$value['rate'] == 0"}@{continue}@{/if}
            <tr>
            <td class="cell cell-empty">&nbsp;</td>
            <td class="cell cell-empty width-px-100 text-nowrap text-right text-bold">
                @{$key} @{$value['rate']}
            </td>
            <td class="cell cell-empty width-px-10 text-nowrap text-right">
                @{$data->currencycode->symbol}
            </td>
            <td class="cell cell-empty width-px-60 text-nowrap text-right">
                @{$value['total']|_int_output_thousands_sep}
            </td>
            </tr>

        @{/loop}
    @{/if}

    @{if="_array($tax_inclusive)"}
        @{loop="$tax_inclusive"}
        @{if="_null($key)"}@{continue}@{/if}
        @{if="$value['rate'] == 0"}@{continue}@{/if}
            <tr>
            <td class="cell cell-empty">&nbsp;</td>
            <td class="cell width-px-100 text-nowrap text-right text-bold">
                Inclusive @{$key} @{$value['rate']}
            </td>
            <td class="cell width-px-10 text-nowrap text-right">
                @{$data->currencycode->symbol}
            </td>
            <td class="cell width-px-60 text-nowrap text-right">
                @{$value['total']|_int_output_thousands_sep}
            </td>
            </tr>
        @{/loop}
    @{/if}

    @{$total=$total+$total_tax_rate}
<!-- /tax per item -->
<!-- tax total amount -->
@{elseif="$data->pointofsale->tax_option == 2"}

    @{if="_array($data->list->taxs)"}
        @{loop="$data->list->taxs"}

            @{if="$value.taxcode_id > 0"}
                @{$value.tax_percent=$value.taxcode_percent} 
                @{$value.tax_rate=$value.taxcode_rate} 
            @{/if}

            @{$tax_rate=_int_output($value.tax_rate)}

            @{if="$value.tax_percent"}

                @{$divide=100}
                @{if="$value.tax_operation == 1"}
                    @{$divide=100+$tax_rate}
                @{/if}

                @{$tax_rate_rate=_calc_percent($total, $tax_rate, $divide)}
            @{else}
                @{$tax_rate_rate=$tax_rate}
            @{/if}

            <tr>
            <td class="cell cell-empty">

            </td>
            <td class="cell width-px-100 text-nowrap text-right text-bold">
                @{if="$value.tax_operation == 1"}
                    Inclusive&nbsp;
                @{/if}
                @{$value.tax_name} @{$value.taxcode_name} @{$tax_rate}@{$value.tax_percent ? "%" : ""}
            </td>
            <td class="cell width-px-10 text-nowrap text-right">
                @{$data->currencycode->symbol}
            </td>
            <td class="cell width-px-60 text-nowrap text-right">
                @{$tax_rate_rate|_int_output_thousands_sep}
            </td>
            </tr>

            @{if="$value.tax_operation == 0"}
                @{$total_tax_rate=$total_tax_rate+$tax_rate_rate}
            @{/if}

        @{/loop}

        @{$total=$total+$total_tax_rate}
    @{/if}
@{/if}
<!-- /tax total amount -->

<!-- rounding -->
@{if="!_null($data->pointofsale->rounding_amount) && $data->pointofsale->rounding_amount != 0"}
    <tr>
    <td class="cell cell-empty">&nbsp;</td>
    <td class="cell width-px-100 text-nowrap text-right text-bold">
        Rounding
    </td>
    <td class="cell width-px-10 text-nowrap text-right">
        @{$data->currencycode->symbol}
    </td>
    <td class="cell width-px-60 text-nowrap text-right">
        @{$data->pointofsale->rounding_amount|_int_output_thousands_sep}
    </td>
    </tr>

    @{$total=$data->pointofsale->total_payable}
@{/if}

<tr>
<td class="cell cell-empty">&nbsp;</td>
<td class="cell width-px-100 text-nowrap text-right text-bold">Grand Total</td>
<td class="cell width-px-10 text-nowrap text-right">
    @{$data->currencycode->symbol}
</td>
<td class="cell width-px-60 text-nowrap text-right">
    @{$total|_int_output_thousands_sep}
</td>
</tr>


<!-- payment -->
@{if="!_null($data->pointofsale->payment)"}
    <tr>
    <td class="cell cell-empty">&nbsp;</td>
    <td class="cell width-px-100 text-nowrap text-right text-bold">
        Paid
    </td>
    <td class="cell width-px-10 text-nowrap text-right">
        @{$data->currencycode->symbol}
    </td>
    <td class="cell width-px-60 text-nowrap text-right">
        @{$data->pointofsale->payment|_int_output_thousands_sep}
    </td>
    </tr>
@{/if}

@{if="!_null($data->pointofsale->payment_change)"}
    <tr>
    <td class="cell cell-empty">&nbsp;</td>
    <td class="cell width-px-100 text-nowrap text-right text-bold">
        Change
    </td>
    <td class="cell width-px-10 text-nowrap text-right">
        @{$data->currencycode->symbol}
    </td>
    <td class="cell width-px-60 text-nowrap text-right">
        @{$data->pointofsale->payment_change|_int_output_thousands_sep}
    </td>
    </tr>
@{/if}

</table>

<center>
@{if="!_null($data->text->note)"}
@{$data->text->note}
@{else}
<h4>Thank you!</h4>
@{/if}
</center>

</td>
</tr>


</table>

</td>
</tr>


</table>

</body>
</html>

